Qualtrics.SurveyEngine.addOnload(function() {
    // Set the maximum number of words allowed, 0 means no limit
    var maxWords = 0;

    // Get the question container using jQuery
    var q = jQuery("#" + this.questionId);

    // Find the text input field within the question container
    var input = q.find(".InputText");

    // Add a word count container after the text input
    input.after("<div class='word-count-container'><span class='word-count-label'>Word count:</span><span class='wordCount' aria-hidden='true'>0</span><span class='maxWords'></span></div>");

    // Find the word count display element
    var display = q.find(".wordCount");

    // If there's a maximum word limit, display it
    if (maxWords > 0) {
        q.find('.maxWords').text("/" + maxWords);
    }

    // Count words on page load
    countWords(input.get(0));

    // Bind the countWords function to the input event
    input.on("input", function() {
        countWords(this);
    });

    // Remove leading and trailing whitespace on blur
    input.blur(function() {
        this.value = this.value.trim();
    });

    function countWords(el) {
        if (el.value.length > 0) {
            if (maxWords > 0) {
                if (el.value.match(/\S+/g).length > maxWords) {
                    el.value = el.value.replace(/(\s+)\S+$/, "$1");
                }
            }
            var wordCount = el.value.match(/\S+/g).length;
            display.text(wordCount);
            display.attr("aria-live", "polite"); // Announce word count changes
        } else {
            display.text("0");
            display.attr("aria-live", "off"); // Disable aria-live if word count is zero
        }
    }
});
