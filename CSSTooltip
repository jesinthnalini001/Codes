var parent = jQuery('#parent');
var popup = jQuery('#tooltip-text');
var closeBtn = jQuery('#btn-closeid');
var title = jQuery('#tooltip-title');
var body = jQuery('#tooltip-body');

parent.on('mouseover focus', function() {
  popup.css('display', 'block');
});

parent.on('blur', function() {
  popup.css('display', 'none');
});

// Hide when ESC is pressed
jQuery(document).on('keydown', function(e) {
  if (e.which === 27) {
    popup.css('display', 'none');
  }
});

closeBtn.click(function() {
  popup.css('display', 'none');
});

parent.attr('tabindex', '0');

parent.on('keydown', function(e) {
  if (e.which === 9) { // Tab key
    var focusableElements = popup.find(':focusable');
    if (focusableElements.length > 0) {
      var firstElement = focusableElements[0];
      var lastElement = focusableElements[focusableElements.length - 1];
      if (e.shiftKey && document.activeElement === firstElement) {
        parent.focus(); // Move focus back to parent when Shift + Tab is pressed on the first focusable element
      } else if (!e.shiftKey && document.activeElement === lastElement) {
        parent.focus(); // Move focus back to parent when Tab is pressed on the last focusable element
      }
    }
  }
});

parent.click(function() {
  if (popup.css('display') === 'none') {
    popup.css('display', 'block'); // Show the popup if it's currently hidden
    title.attr('tabindex', '0'); // Add tabindex to the title
    closeBtn.attr('tabindex', '0'); // Add tabindex to the close button
    body.attr('tabindex', '0'); // Add tabindex to the body
    title.focus(); // Move focus to the title
  } else {
    popup.css('display', 'none'); // Hide the popup if it's currently visible
  }
});

.sr-only {
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  overflow: hidden !important;
  clip: rect(0, 0, 0, 0) !important;
  white-space: nowrap !important;
  border: 0 !important;
}
